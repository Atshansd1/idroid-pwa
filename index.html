<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>iDroid Android Web</title>
    <link rel="manifest" href="./manifest.webmanifest" />
    <meta name="theme-color" content="#111" />
    <!-- iOS PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="iDroid" />
    <!-- Optional: apple-touch-icon can be added later -->
    <style>
      html, body { height: 100%; margin: 0; background: #0b0b0b; }
      .frame { position: fixed; inset: 0; border: 0; width: 100%; height: 100%; }
      .banner { position: fixed; top: 8px; left: 8px; right: 8px; z-index: 10; display: flex; justify-content: space-between; align-items: center; }
      .banner span { color: #fff; font: 500 14px/1.6 system-ui, -apple-system; opacity: 0.9; }
      .btn { background: #1e90ff; color: #fff; border: 0; border-radius: 8px; padding: 8px 12px; font: 600 13px/1.2 system-ui, -apple-system; cursor: pointer; }
    </style>
  </head>
  <body>
    <div class="banner">
      <span>Open in Safari → Share → Add to Home Screen</span>
      <div style="display:flex; gap:8px; align-items:center;">
        <input id="tunnelInput" type="url" placeholder="https://your-tunnel.trycloudflare.com/" style="width: 320px; padding:6px 8px; border-radius:8px; border:1px solid #333; background:#111; color:#fff;" />
        <button id="saveTunnel" class="btn">Use Tunnel</button>
        <button id="installBtn" class="btn" hidden>Add to Home Screen</button>
      </div>
    </div>
    <iframe id="androidFrame" class="frame" src="" allow="clipboard-read; clipboard-write; fullscreen; autoplay; microphone; camera"></iframe>

    <script>
      const frame = document.getElementById('androidFrame');
      const input = document.getElementById('tunnelInput');
      const saveBtn = document.getElementById('saveTunnel');

      const defaultTunnel = 'https://listing-lanes-gravity-dispatched.trycloudflare.com/';
      const storedTunnel = window.localStorage.getItem('TUNNEL_URL');
      const TUNNEL_URL = storedTunnel || defaultTunnel;
      input.value = TUNNEL_URL;
      frame.src = TUNNEL_URL;

      saveBtn.addEventListener('click', () => {
        const url = input.value.trim();
        if (!url) return;
        try {
          const u = new URL(url);
          window.localStorage.setItem('TUNNEL_URL', u.href);
          frame.src = u.href;
        } catch (e) {
          alert('Please enter a valid https:// URL');
        }
      });

      // PWA install prompt
      let deferredPrompt;
      const installBtn = document.getElementById('installBtn');
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.hidden = false;
      });
      installBtn.addEventListener('click', async () => {
        installBtn.hidden = true;
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        await deferredPrompt.userChoice;
        deferredPrompt = null;
      });

      // Register service worker for PWA
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').catch(console.error);
      }
    </script>
  </body>
  </html>
